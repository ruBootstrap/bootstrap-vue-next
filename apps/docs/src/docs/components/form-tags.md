# Теги формы

<PageHeader>

Лёгкий кастомный элемент для ввода тегов с возможностью настройки интерфейса, обнаружения дубликатов и валидации тегов.

</PageHeader>

Теги — это массивы коротких строк, используемых, например, для присвоения категорий. Используйте стандартный интерфейс или создайте свой через scoped slot по умолчанию.

## Базовое использование

Пробелы в начале и конце тегов будут удалены, дубликаты не допускаются. Теги с пробелами внутри разрешены по умолчанию.

Теги добавляются по нажатию кнопки «Добавить», клавиши <kbd>Enter</kbd> или (опционально) при срабатывании события `change` на поле ввода нового тега (например, при потере фокуса). Кнопка _Добавить_ появляется только если пользователь ввёл новый тег.

<<< DEMO ./demo/FormTagsBasic.vue

## Создание тегов с помощью разделителей

Чтобы автоматически создавать тег при вводе разделителя (например, <kbd>Пробел</kbd>, <kbd>,</kbd> и т.д.), установите пропс `separator` в нужный символ. Для нескольких разделителей используйте строку (например, ' ,;') или массив символов (например, `[' ', ',', ';']`). Разделители должны быть одиночными символами.

В примере ниже тег будет создан при вводе <kbd>Пробел</kbd>, <kbd>,</kbd> или <kbd>;</kbd>:

<<< DEMO ./demo/FormTagsSeparators.vue

## Удаление последнего тега клавишей Backspace

Если установлен пропс `remove-on-delete`, при нажатии <kbd>Backspace</kbd> (или <kbd>Del</kbd>) и пустом поле ввода последний тег будет удалён.

<<< DEMO ./demo/FormTagsRemoval.vue

## Варианты стилизации

Доступно несколько пропсов для изменения внешнего вида стандартного интерфейса тегов:

| Пропс         | Описание                                                                            |
| ------------- | ----------------------------------------------------------------------------------- |
| `tag-pills`   | Отображает теги в виде «пилюль»                                                     |
| `tag-variant` | Применяет одну из цветовых тем Bootstrap к тегам                                    |
| `size`        | Размер компонента: `sm`, `md` (по умолчанию) или `lg`                               |
| `placeholder` | Плейсхолдер для поля ввода нового тега                                              |
| `state`       | Контекстное состояние: `true` (валидно), `false` (невалидно), `null` (по умолчанию) |
| `disabled`    | Переводит компонент в неактивное состояние                                          |

Дополнительные пропсы см. в справочном разделе ниже.

Стили фокуса и состояния валидации компонента реализованы через кастомный CSS BootstrapVueNext.

<<< DEMO ./demo/FormTagsStyle.vue

## Использование с нативной отправкой формы

Значение поля тегов не будет отправлено через стандартный form `action`, если не задан пропс name. Если name задан, `<BFormTags>` создаст скрытый `<input>` для каждого тега с атрибутом name.

Скрытые поля также создаются при [кастомном рендеринге](#custom-rendering-with-default-scoped-slot) (если задан name).

## Валидация тегов

По умолчанию `<BFormTags>` определяет попытку ввода дубликата (чувствительно к регистру) и показывает встроенное сообщение.

Можно передать свою функцию-валидатор через пропс `tag-validator`. Она получает тег и должна вернуть `true` (тег валиден) или `false` (тег не добавляется). Пользователь увидит сообщение о невалидных тегах.

Валидация применяется только к тегам, добавленным через пользовательский ввод. Изменения через v-model не валидируются.

<<< DEMO ./demo/FormTagsValidation.vue

### Обнаружение новых, невалидных и дублирующихся тегов

Событие `tag-state` срабатывает при вводе новых тегов, обнаружении невалидных или дубликатов. Обработчик получает три массива:

- `validTags` — валидные теги
- `invalidTags` — невалидные теги
- `duplicateTags` — дубликаты

Событие срабатывает только при изменении поля ввода нового тега или попытке добавить тег (через <kbd>Enter</kbd>, кнопку **Добавить** или разделитель). Все три массива будут пустыми, если поле ввода очищено (или содержит только пробелы).

Если вы реализуете собственную обратную связь для дубликатов и невалидных тегов (через событие tag-state), можно отключить встроенные сообщения, установив пропсы duplicate-tag-text и invalid-tag-text в пустую строку ('') или null.

<<< DEMO ./demo/FormTagsState.vue

## Ограничение количества тегов

Чтобы ограничить количество тегов, используйте пропс `limit`. Если лимит достигнут, добавить новые теги можно только через v-model.

Когда лимит достигнут, пользователь может вводить текст, но добавить тег не получится. Показывается сообщение, которое можно настроить через пропс `limit-tags-text`. Пустая строка (`''`) или null отключают сообщение.

Удаление тегов не зависит от лимита.

<<< DEMO ./demo/FormTagsLimit.vue

## Кастомный рендеринг через scoped slot

Если нужен другой внешний вид, реализуйте свой интерфейс через scoped slot по умолчанию. Можно использовать как свои теги, так и вспомогательный компонент `<BFormTag>`.

### Свойства слота

Scoped slot предоставляет множество свойств и методов для кастомного рендеринга. Не все из них обязательны.

| Свойство           | Тип                           | Описание                                                                                         |
| ------------------ | ----------------------------- | ------------------------------------------------------------------------------------------------ |
| `addButtonText`    | `string`                      | Значение пропса `add-button-text`                                                                |
| `addButtonVariant` | `ButtonVariant \| null`       | Значение пропса `add-button-variant`                                                             |
| `addTag`           | `(tag?: string) => void`      | Метод для добавления тега. По умолчанию берёт значение из поля ввода, но можно передать тег явно |
| `disableAddButton` | `boolean`                     | true, если теги в поле не могут быть добавлены (все невалидны или дубликаты)                     |
| `disabled`         | `boolean`                     | true, если компонент неактивен (пропс `disabled`)                                                |
| `duplicateTagText` | `string`                      | Значение пропса `duplicate-tag-text`                                                             |
| `duplicateTags`    | `string[]`                    | Массив дубликатов                                                                                |
| `form`             | `string`                      | Значение пропса `form`                                                                           |
| `inputAttrs`       | `object`                      | Атрибуты для поля ввода нового тега (см. ниже)                                                   |
| `inputHandlers`    | `object`                      | Обработчики событий для поля ввода нового тега (см. ниже)                                        |
| `inputId`          | `string`                      | id для поля ввода нового тега. По умолчанию — пропс `input-id` или сгенерированный id            |
| `inputType`        | `InputType`                   | Тип поля ввода (нормализованный пропс `input-type`)                                              |
| `invalidTagText`   | `string`                      | Значение пропса `invalid-tag-text`                                                               |
| `invalidTags`      | `string[]`                    | Массив невалидных тегов                                                                          |
| `isDuplicate`      | `boolean`                     | true, если пользователь ввёл дубликаты                                                           |
| `isInvalid`        | `boolean`                     | true, если пользователь ввёл невалидные теги                                                     |
| `isLimitReached`   | `boolean`                     | true, если достигнут лимит                                                                       |
| `limitTagsText`    | `boolean`                     | Значение пропса `limit-tags-text`                                                                |
| `limit`            | `number`                      | Значение пропса `limit`                                                                          |
| `noTagRemove`      | `boolean`                     | Значение пропса `no-tag-remove`                                                                  |
| `placeholder`      | `string`                      | Значение пропса `placeholder`                                                                    |
| `removeTag`        | `(tag?: string) => void`      | Метод для удаления тега. Принимает тег для удаления                                              |
| `required`         | `boolean`                     | Значение пропса `required`                                                                       |
| `separator`        | `string \| readonly string[]` | Значение пропса `separator`                                                                      |
| `size`             | `Size`                        | Значение пропса `size`                                                                           |
| `state`            | `ValidationState`             | Контекстное состояние компонента (`state`). Возможные значения: `true`, `false`, `null`          |
| `tagClass`         | `ClassValue`                  | Значение пропса `tag-variant`. Класс(ы) для тегов                                                |
| `tagPills`         | `boolean`                     | Значение пропса `tag-pills`                                                                      |
| `tagRemoveLabel`   | `string`                      | Значение пропса `tag-remove-label`. Используется как aria-label на кнопке удаления тега          |
| `tagVariant`       | `ColorVariant \| null`        | Значение пропса `tag-variant`                                                                    |
| `tags`             | `string[]`                    | Массив текущих тегов                                                                             |

#### Свойства объекта `inputAttrs`

Объект `inputAttrs` содержит атрибуты для биндинга (`v-bind`) к полю ввода нового тега.

| Свойство | Тип       | Описание                                           |
| -------- | --------- | -------------------------------------------------- |
| disabled | `boolean` | Атрибут disabled для поля ввода (пропс `disabled`) |
| form     | `string`  | Значение пропса `form`                             |
| id       | `string`  | id для поля ввода                                  |
| value    | `string`  | value для поля ввода                               |

Также в `inputAttrs` попадут атрибуты из пропса `input-attrs`, но вышеуказанные имеют приоритет.

#### Свойства объекта `inputHandlers`

Объект `inputHandlers` содержит обработчики событий для биндинга (`v-on`) к полю ввода нового тега.

| Свойство  | Тип                                      | Описание                                                                             |
| --------- | ---------------------------------------- | ------------------------------------------------------------------------------------ |
| `change`  | `(e: Readonly<Event> \| string) => void` | Обработчик события change. Принимает событие или строку. Добавляет тег               |
| `input`   | `(e: Readonly<Event> \| string) => void` | Обработчик события input. Принимает событие или строку. Обновляет v-model поля ввода |
| `keydown` | `(e: Readonly<KeyboardEvent>) => void`   | Обработчик keydown для Enter и Del. Принимает объект события                         |

Обработчик `change` работает только если включён пропс `add-on-change`, иначе это пустая функция.

### Использование с нативными input

В scope есть атрибуты и обработчики, которые можно напрямую привязывать к нативным `<input>` или `<select>`.

В примере ниже показаны рекомендуемые ARIA-атрибуты и роли для поддержки экранных читалок.

<<< DEMO ./demo/FormTagsNative.vue

### Использование с кастомными компонентами

Scope содержит атрибуты и обработчики, которые можно привязывать к большинству кастомных input/select (обработчики принимают строку или событие). Любой компонент, который эмитит `input` при вводе символов и (опционально) `change` при изменении значения (blur/select), и использует пропс `value` как v-model, будет работать без изменений.

В этом примере используется вспомогательный компонент [`<BFormTag>`](#bformtag-helper-component), но можно использовать и обычный HTML.

<<< DEMO ./demo/FormTagsCustom.vue

Ниже пример с кастомным select для выбора из предопределённых тегов:

<<< DEMO ./demo/FormTagsSelect.vue

Если кастомный input использует свои имена событий, похожие на `input`, `change` или `keydown`, можно привязать обработчики так:

<<< FRAGMENT ./demo/FormTagsEvents.vue#template{vue-html}

Обработчик `inputHandlers.input` должен быть привязан к событию, которое обновляет значение при каждом вводе символа, чтобы работала валидация «на лету».

### Продвинутый кастомный рендеринг

Если `inputHandlers` не подходят для вашего input или нужен больший контроль, используйте дополнительные свойства из scope слота.

<<< DEMO ./demo/FormTagsScopedSlot.vue

Ниже пример с использованием `<BDropdown>` для выбора/поиска по предопределённому списку тегов:

<<< DEMO ./demo/FormTagsDropdown.vue

### Создание обёрточных компонентов

Можно легко создать свой компонент-обёртку с нужным стилем рендеринга:

<<< FRAGMENT ./demo/FormTagsWrapper.vue

## Вспомогательный компонент `<BFormTag>`

BootstrapVueNext предоставляет вспомогательный компонент `<BFormTag>` для использования в scoped slot по умолчанию `<BFormTags>`. Он основан на [`<BBadge>`](/docs/components/badge) и [`<BButton>`](/docs/components/button).

`<BFormTag>` поддерживает те же варианты, что и `<BBadge>`, и стиль pill. Размер зависит от font-size контейнера.

Событие remove эмитится при клике по кнопке удаления тега.

Теги, слишком длинные для контейнера, автоматически обрезаются с троеточием. Поэтому рекомендуется указывать title через пропс при использовании слота для содержимого тега.

Обратите внимание: `<BFormTag>` требует кастомный CSS/SCSS BootstrapVueNext для корректного отображения.

<ComponentReference :data="data" />

<script setup lang="ts">
import {data} from '../../data/components/formTags.data'
</script>
